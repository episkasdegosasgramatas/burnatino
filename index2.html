<script>
function escapeHtml(s){
    return s.replaceAll('&','&amp;')
            .replaceAll('<','&lt;')
            .replaceAll('>','&gt;');
}

// Ielādēt ziņas no servera
async function loadMessages() {
    const res = await fetch("/api/messages");
    const messages = await res.json();

    const board = document.getElementById("messageBoard");

    if (messages.length === 0) {
        board.innerHTML = "<p style='color:#0f0'>Nav nevienas ziņas...</p>";
        return;
    }

    board.innerHTML = messages.map(msg => `
        <div style="border:1px solid #0f0;padding:10px;margin-bottom:10px;">
            <div style="white-space:pre-wrap;color:#0f0;">${msg.text}</div>
            <div style="color:#090;font-size:12px;margin-top:5px;">${msg.time}</div>
        </div>
    `).join('');
}

// Nosūtīt jaunu ziņu serverim
async function handleSubmit(e){
    e.preventDefault();
    const content = document.getElementById('content').value.trim();
    if (!content) return false;

    const safe = escapeHtml(content);

    await fetch("/api/messages", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text: safe })
    });

    document.getElementById("content").value = "";
    loadMessages();
}

loadMessages();
</script>
